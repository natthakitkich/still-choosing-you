const content = document.getElementById("content");
const card = document.getElementById("card");

const startNav = document.getElementById("startNav");
const pageNav = document.getElementById("pageNav");

const startBtn = document.getElementById("startBtn");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const bgm = document.getElementById("bgm");

let pageIndex = -1;

/* ===============================
   ข้อความต้นฉบับ 100%
   =============================== */
const rawText = `
สวัสดีปีใหม่นะงับที่รัก

ปีนี้เป็นปีที่ดีมาก ๆ สำหรับเราเลยนะ
และเราอยากบอกเธอจากใจว่า คนที่ทำให้เรารู้สึกแบบนั้นได้ คือเธอนะ

ถ้ามองย้อนกลับไปเธอคือคนแรก และเป็นคนเดียวที่ทำให้เรากลับมามีพลังใจ 

มีรอยยิ้ม และค่อย ๆ กลับมารู้สึกว่าชีวิตมันเบาขึ้นมาก ๆ ในปีนึ้

เราไม่เคยคิดเลยว่าตัวเองจะกลับมามีความสุขได้มากขนาดนี้ 

กลับมาดีขึ้นได้ขนาดนี้ 

มันเหมือนหัวใจที่เคยพังทลายและสูญเสียตัวตน

มันค่อย ๆ ฟื้นตัวและกลับมาเป็นเราในเวอร์ชั่นที่เราภูมิใจและรู้สึกว่ามันดีกับตัวเราและคนรอบข้าง

ซึ่งทั้งหมดนี้ เราพูดได้เต็มปากว่ามันเกิดขึ้นเพราะมีเธออยู่ตรงนี้…ข้าง ๆ เรา 

ไม่ว่าที่ผ่านมาเราจะทำตัวแย่แค่ไหน แต่เธอก็ยังไม่ปล่อยมือเรา

ปีนี้เราเดินมาด้วยกันหลายช่วงเวลามาก
เดือนมีนาคมมันยังชัดอยู่ในความทรงจำของเรา

วันที่เธอบินมาหาเราตามสัญญาที่เคยให้กันไว้
วันเกิดปีนี้ของเราทั้งคู่ เป็นวันที่เรามีความสุขมากจริง ๆ

เราได้ใช้เวลา 

ได้หัวเราะ 

ได้อยู่ด้วยกันแบบไม่ต้องรีบ

มันเป็นความเรียบง่าย แต่เต็มไปด้วยความสุข

และมันทำให้เรารู้ว่า...

ความรักของเรามันมีตัวตนจริง ๆ

หลังจากนั้นเราก็ตั้งใจทำตามสัญญาของเราเหมือนกัน

ด้วยการบินไปหาเธอที่อินโดฯ

มันเป็นการเดินทางไกลที่สุดในชีวิตเรา
และก็เป็นการเดินทางที่มีความสุขที่สุดเหมือนกัน

ตลอดเดือนตุลาคมที่เราได้อยู่กับเธอทั้งที่จาการ์ตาและบาหลี
มันเป็นช่วงเวลาที่มีความหมายมากสำหรับเรา

แม้เธอจะงานยุ่ง แต่เธอก็ยังทำให้เรารู้สึกว่าเราถูกเลือก

ถูกใส่ใจ 

และถูกรัก 

เรามีความสุขมากจริง ๆ

และเราภูมิใจในตัวเองมาก ที่เราทำตามสัญญานั้นได้

ขอบคุณเธอที่เป็นแรงผลักดัน เป็นกำลังใจ
และเป็นเหตุผลที่ทำให้เรากล้าก้าวไปไกลขนาดนั้นได้

แต่แน่นอนว่าปีนี้ไม่ได้มีแค่ช่วงเวลาที่ราบรื่นทั้งหมด

คนเรามีวันที่พลาด วันที่อ่อนแอกันได้

แต่สิ่งนึงที่เราอยากบอกเธอให้ชัดที่สุดคือ

แม้จะมีวันที่ยากสำหรับเรา 

แต่เราก็ยังเลือกเธอนะ

และเราก็ผ่านมาได้ด้วยกันแล้ว

เราอยากทิ้งทุกเรื่องที่หนักใจ ทุกความผิดพลาดไว้ในปีที่ผ่านมา 

แล้วจับมือกันก้าวไปข้างหน้าในปีใหม่ 

ด้วยหัวใจที่เรียนรู้ 

เติบโต และเข้าใจกันมากขึ้น

เรารักเธอมาก
รักเธอที่สุด

และการที่เรายังเลือกเธออยู่ตรงนี้
ไม่ใช่เพราะมันง่าย ไม่ใช่เพราะเราอยากได้อะไรจากเธอ

แต่เพราะเราเห็นเป้าหมายของชีวิตเรา
เราเห็นภาพของชีวิตคู่ของเรา

เห็นอนาคตที่มีคำว่า “เรา” ทั้งคู่อยู่ในนั้น

เหมือนเพลงที่เราเขียน

Still choosing you…

เรายังเลือกเธอ

วันนี้ พรุ่งนี้ และในทุกวันที่เราจะเดินไปข้างหน้า

เราก็ยังเลือกเธอนะ

สุดท้ายขอให้ปีใหม่นี้เป็นปีที่ดีสำหรับเราทั้งคู่
ขอให้เราทั้งคู่มีสติ มีความเข้มแข็ง และเจอแต่สิ่งดี ๆ 

และถ้าวันไหนต้องเจอเรื่องไม่ดี ก็ขอให้เรายังจับมือกันแน่น ๆ
และก้าวข้ามมันไปด้วยกัน
เหมือนที่เราเคยพูด เคยตั้งใจ และเคยสัญญากันไว้

เราขอบคุณเธอสำหรับทุกอย่างที่ผ่านมา

ขอบคุณที่รักเรา

ขอบคุณที่อยู่ข้างกัน

และขอบคุณที่ทำให้ปีนี้ของเรามีความหมายขนาดนี้

สวัสดีปีใหม่นะงับ
เรารักเธอนะ 

นักการทูตคนเก่งของชั้น
`;

/* แยกหน้า */
const pages = rawText.trim().split(/\n\s*\n/);

/* ===== หน้าแรก ===== */
function showStart() {
  pageIndex = -1;
  content.textContent =
`การ์ดใบนี้
เขียนถึงคนคนเดียว

กดเพื่อเปิดอ่านการ์ด`;

  startNav.classList.remove("hidden");
  pageNav.classList.add("hidden");

  nextBtn.textContent = "ถัดไป";
}

/* ===== Cross-fade render ===== */
function renderPage() {
  card.classList.add("fade");

  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      content.textContent = pages[pageIndex];
      card.classList.remove("fade");

      if (pageIndex === pages.length - 1) {
        nextBtn.textContent = "จบแล้ว";
      } else {
        nextBtn.textContent = "ถัดไป";
      }
    });
  });
}

/* ===== Init ===== */
showStart();

/* ===== Start ===== */
startBtn.onclick = () => {
  bgm.volume = 0;
  bgm.play().catch(() => {});

  let v = 0;
  const fadeIn = setInterval(() => {
    v += 0.02;
    bgm.volume = Math.min(v, 1);
    if (v >= 1) clearInterval(fadeIn);
  }, 100);

  pageIndex = 0;
  startNav.classList.add("hidden");
  pageNav.classList.remove("hidden");
  renderPage();
};

/* ===== Next ===== */
nextBtn.onclick = () => {
  if (pageIndex < pages.length - 1) {
    pageIndex++;
    renderPage();
  } else {
    showStart();
  }
};

/* ===== Prev ===== */
prevBtn.onclick = () => {
  if (pageIndex > 0) {
    pageIndex--;
    renderPage();
  }
};
